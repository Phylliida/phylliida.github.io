
<html>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<head>
 <script src="/js/comet.js"></script>
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
</head>
<body>
 
 <input id="message"></input>
 <button id="submitMessage">Submit</button>
 
<script>
$(document).ready(function () {

// Make me a server with Google Gears support enabled
var server = new Addressable.Server({ useGears: true });

// When a message arrives, just "log" it
server.onmessage = function (message) {
console.log(message)
}

// Out subscription scope is the current URL
var scope = location.href;

// Connect to the UniversalComet server
server.connect(function (id, url) {
  console.log("Connected.")
  // When connected subcribe to the scope
  server.subscribe(scope, function () {
   console.log("Joined channnel")
   // When subscribed, post "Hi All"
   server.post(scope, "Hi All")
})

// Subscription expire after 5 Minutes. Renew ours every 4 Minutes.
setInterval(function () { // renew subscription
server.subscribe(scope, function () {})
}, 1000 * 4 * 60)
})

// When the "chatForm" is submitted post the message to the scope on UniversalComet
var message = $("#message").focus();
$("#submitMessage").click(function (e) {
server.post(scope, message.val())
message.val("")
e.preventDefault() // Dont really submit the form
})

})
</script> 
</body>
</html>






