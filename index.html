<html>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
  
  <head>
    <script src="/js/pubnub.js"></script>
    <script src="/js/webrtc.js"></script>
     <script src='https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script> 
    
  </head>
  <body>
    
    <input id="ayy"></input>
  
  <button id="beans">Hi</button>
    
    
    
    <script>
      
    var users = [];
      
    var user = PUBNUB.uuid();
    var pubnub = PUBNUB.init({
      publish_key: 'pub-c-a2281ecc-42fb-47c8-91b6-f80ad06357ca',
      subscribe_key: 'sub-c-bfbc4b56-0904-11e7-b95c-0619f8945a4f',
      uuid: user,
      ssl: true
    });
      
      
    
     $("#beans").click(function()
     {
       for (var i = 0; i < users.length; i++)
       {
        pubnub.publish({
          user: users[i],
          message: ($("#ayy").val() + "")
        });
       }
     });
      
      
      
    var pubnubMain = PUBNUB.init({
      publish_key: 'pub-c-a2281ecc-42fb-47c8-91b6-f80ad06357ca',
      subscribe_key: 'sub-c-bfbc4b56-0904-11e7-b95c-0619f8945a4f',
      ssl: true
    });
      
     pubnubMain.subscribe({ 
        // connect to a channel 
        channel : "lobby", 
        // resubscribe and reconnect
        restore : true, 
        // message received 
        callback : function(newUser) {
          if (newUser + "" == user + "")
          {
            return;
          }
          
          users.push(newUser);
          
           pubnub.subscribe({
            user: newUser,
            callback: function (message) {
              alert(message + " from " + newUser);
             }
           });
       
        }, 
        //  conneciton lost
        disconnect : function() {alert("Connection Lost!")}, 
        // connection restored 
        reconnect : function() {alert("And we're Back!")}, 
        // connection established 
        connect : function() { 
            // send a message 
            pubnubMain.publish({ 
                channel : "lobby", 
                message : user 
            }) 
        }
     });
      
      
      
    </script>
    
  </body>
</html>
 



